<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CSV保存ツール</title>
<style>
  body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
  .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  textarea { width: 100%; height: 200px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; font-family: monospace; box-sizing: border-box; }
  .controls { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
  select, button { padding: 10px; font-size: 16px; height: 44px; box-sizing: border-box; }
  button { background: #007bff; color: white; border: none; border-radius: 4px; flex-grow: 1; font-weight: bold; }
  label { font-size: 14px; font-weight: bold; }
</style>
</head>
<body>

<div class="container">
  <h3>CSV作成・保存</h3>
  <p style="font-size:12px; color:#666;">Excelやメモ帳からデータを貼り付けてください。</p>
  
  <textarea id="content" placeholder="ID,科目名,備考&#13;&#10;1,現金,&#13;&#10;2,普通預金,メイン"></textarea>
  
  <div class="controls">
    <select id="encoding">
      <option value="utf-8-bom">UTF-8 (BOM付: Excel/iPhone用)</option>
      <option value="utf-8">UTF-8 (標準)</option>
    </select>
    <button onclick="saveFile()">CSVを保存</button>
  </div>
</div>

<script>
function saveFile() {
  const text = document.getElementById('content').value;
  if (!text) return alert("テキストを入力してください");

  const encoding = document.getElementById('encoding').value;
  let blob;

  // エンコード処理
  if (encoding === 'utf-8-bom') {
    // BOM (Byte Order Mark) を付与してExcelで文字化けしないようにする
    const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
    blob = new Blob([bom, text], { type: 'text/csv' });
  } else {
    blob = new Blob([text], { type: 'text/csv' });
  }

  // ダウンロードリンク生成
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'data.csv';
  document.body.appendChild(a); // Firefox/iOS対応のため追加
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
</script>

</body>
</html>
