<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ©ãƒ™ãƒ«ä½œæˆ (ä½ç½®èª¿æ•´ãƒ»ç·¨é›†æ©Ÿèƒ½ä»˜)</title>
<style>
    /* --- å¤‰æ•°å®šç¾© (ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ã“ã“ã‚’æ›¸ãæ›ãˆã‚‹) --- */
    :root {
        --gap-size: 12.2mm; /* 2ã¤ã®æ–‡å­—ã®é–“éš” (Pythonã® 6.1mm * 2) */
        --offset-x: 0mm;    /* å…¨ä½“ã®å·¦å³ã‚ºãƒ¬è£œæ­£ */
        --offset-y: 0mm;    /* å…¨ä½“ã®ä¸Šä¸‹ã‚ºãƒ¬è£œæ­£ */
        
        /* A4æ¨ª (Pythonã‚³ãƒ¼ãƒ‰ã®åº§æ¨™ç³»ãƒ™ãƒ¼ã‚¹) */
        --cell-w: 31.5mm; 
        --cell-h: 24.8mm;
        /* Python: start_x=275.6mm, start_y=195.4mm ã‹ã‚‰ã®é€†ç®— */
        --margin-top: 2.2mm;   
        --margin-right: 5.65mm;
    }

    /* --- åŸºæœ¬UI --- */
    body { font-family: sans-serif; background: #333; margin: 0; padding: 0; color: #fff; }
    
    /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« (å›ºå®šè¡¨ç¤º) */
    #controls {
        background: #222; border-bottom: 1px solid #444; padding: 15px;
        position: sticky; top: 0; z-index: 100;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    .control-row { display: flex; flex-wrap: wrap; gap: 20px; align-items: center; margin-bottom: 10px; }
    .control-group { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; }
    
    input[type="range"] { width: 100px; cursor: pointer; }
    input[type="number"] { width: 50px; padding: 4px; border-radius: 4px; border: none; }
    button { padding: 6px 12px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; background: #444; color: white; transition: 0.2s; }
    button:hover { background: #666; }
    button.primary { background: #007bff; }
    button.success { background: #28a745; }

    /* --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ --- */
    #previewArea {
        padding: 40px; background: #525659; min-height: 100vh;
        display: flex; justify-content: center;
    }

    /* --- ã‚·ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (A4 æ¨ª) --- */
    @page { size: A4 landscape; margin: 0; }
    
    .sheet {
        width: 297mm; height: 210mm; background: white;
        position: relative; overflow: hidden;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        margin-bottom: 30px;
        color: black; /* å°åˆ·æ–‡å­—è‰² */
    }

    /* ã‚°ãƒªãƒƒãƒ‰ã‚³ãƒ³ãƒ†ãƒŠ */
    .grid-container {
        position: absolute;
        /* ä½™ç™½ + å¾®èª¿æ•´ã‚ªãƒ•ã‚»ãƒƒãƒˆ */
        top: calc(var(--margin-top) + var(--offset-y));
        right: calc(var(--margin-right) - var(--offset-x)); /* RTLãªã®ã§å³åŸºæº– */
        
        width: calc(var(--cell-w) * 9);
        height: calc(var(--cell-h) * 8);
        
        display: grid;
        direction: rtl; /* å³ã‹ã‚‰å·¦ã¸ */
        grid-template-columns: repeat(9, var(--cell-w));
        grid-template-rows: repeat(8, var(--cell-h));
        grid-auto-flow: column; 
    }

    /* ã‚»ãƒ« */
    .cell {
        width: var(--cell-w); height: var(--cell-h);
        position: relative;
        border: 0.5px dotted #ddd; /* ç·¨é›†ç”¨ã‚¬ã‚¤ãƒ‰ç·š */
        box-sizing: border-box;
    }
    
    /* ãƒ†ã‚­ã‚¹ãƒˆé…ç½®ã‚¨ãƒªã‚¢ */
    .text-container {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        width: 100%; height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: var(--gap-size); /* ã“ã“ã§é–“éš”èª¿æ•´ */
    }

    /* æ–‡å­—ã‚¹ã‚¿ã‚¤ãƒ« */
    .label-text {
        writing-mode: vertical-rl;
        text-orientation: upright;
        font-family: "HeiseiMin-W3", "Hiragino Mincho ProN", "Yu Mincho", serif;
        font-size: 10pt;
        white-space: nowrap;
        cursor: text; /* ç·¨é›†å¯èƒ½ã‚«ãƒ¼ã‚½ãƒ« */
        outline: none; /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®æ ç·šã‚’æ¶ˆã™ */
        padding: 2px;
    }
    .label-text:hover { background: #f0f8ff; } /* ç·¨é›†å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ */
    .label-text:focus { background: #e8f0fe; border-bottom: 1px solid blue; }

    /* å°åˆ·æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    @media print {
        body { background: white; margin: 0; }
        #controls, #previewArea { padding: 0; background: white; display: block; }
        #controls { display: none !important; }
        .sheet { margin: 0; box-shadow: none; page-break-after: always; }
        .cell { border: none; }
        .label-text:hover { background: none; }
    }
</style>
</head>
<body>

<div id="controls">
    <div class="control-row">
        <strong>ğŸ› èª¿æ•´ãƒ»ç·¨é›†</strong>
        
        <div class="control-group" style="margin-left: 20px;">
            <label>æ–‡å­—é–“éš”(æŠ˜ã‚Šç›®):</label>
            <input type="range" id="gapRange" min="0" max="25" step="0.5" value="12.5" oninput="updateStyles()">
            <span id="gapVal">12.5</span>mm
        </div>

        <div class="control-group">
            <label>å…¨ä½“ æ¨ªä½ç½®:</label>
            <input type="range" id="xRange" min="-20" max="20" step="0.5" value="0" oninput="updateStyles()">
            <span id="xVal">0</span>mm
        </div>
        
        <div class="control-group">
            <label>å…¨ä½“ ç¸¦ä½ç½®:</label>
            <input type="range" id="yRange" min="-20" max="20" step="0.5" value="0" oninput="updateStyles()">
            <span id="yVal">0</span>mm
        </div>
    </div>

    <div class="control-row">
        <div class="control-group">
            <input type="file" id="csvFile" accept=".csv" onchange="loadCSV(this)" style="display:none;">
            <button class="primary" onclick="document.getElementById('csvFile').click()">ğŸ“‚ CSVèª­è¾¼</button>
            <button onclick="loadSample()">ã‚µãƒ³ãƒ—ãƒ«èª­è¾¼</button>
        </div>
        
        <div class="control-group" style="margin-left:auto;">
             <label>é–‹å§‹ä½ç½®: <input type="number" id="startPos" value="0" min="0" onchange="render()"></label>
        </div>
        
        <button class="success" onclick="window.print()" style="margin-left: 10px; font-size:1.1em;">ğŸ–¨ å°åˆ·</button>
    </div>
    <div style="font-size: 0.8rem; color: #ccc;">â€»æ–‡å­—ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ç›´æ¥ç·¨é›†ã§ãã¾ã™ã€‚ä¸¡å´ã®æ–‡å­—ã¯é€£å‹•ã—ã¾ã›ã‚“ï¼ˆå€‹åˆ¥ã«ä¿®æ­£ã—ã¦ãã ã•ã„ï¼‰ã€‚</div>
</div>

<div id="previewArea"></div>

<script>
// åˆæœŸè¨­å®š
let csvData = [];
const rows = 9; 
const cols = 8;

window.onload = function() {
    loadSample();
};

// ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤åæ˜ 
function updateStyles() {
    const root = document.documentElement;
    const gap = document.getElementById('gapRange').value;
    const x = document.getElementById('xRange').value;
    const y = document.getElementById('yRange').value;
    
    root.style.setProperty('--gap-size', gap + 'mm');
    root.style.setProperty('--offset-x', x + 'mm');
    root.style.setProperty('--offset-y', y + 'mm');
    
    document.getElementById('gapVal').textContent = gap;
    document.getElementById('xVal').textContent = x;
    document.getElementById('yVal').textContent = y;
}

// ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
function loadSample() {
    const data = "ID,ç§‘ç›®å\n1,ç¾é‡‘\n2,å½“åº§é é‡‘\n3,æ™®é€šé é‡‘\n4,å—å–æ‰‹å½¢\n5,å£²æ›é‡‘\n6,æ£šå¸è³‡ç”£\n7,å‰æ‰•è²»ç”¨\n8,å»ºç‰©\n9,æ§‹ç¯‰ç‰©\n10,æ©Ÿæ¢°è£…ç½®\n11,å‚™å“\n12,åœŸåœ°\n13,å€Ÿå…¥é‡‘\n14,è³‡æœ¬é‡‘\n15,å£²ä¸Šé«˜";
    csvData = parseCSV(data);
    render();
}

// CSVèª­ã¿è¾¼ã¿
function loadCSV(input) {
    if (!input.files[0]) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        csvData = parseCSV(e.target.result);
        render();
    };
    reader.readAsText(input.files[0]); // UTF-8æƒ³å®š
}

function parseCSV(text) {
    return text.split(/\r\n|\n/).map(line => {
        // ç°¡æ˜“ãƒ‘ãƒ¼ã‚¹: 2åˆ—ç›®ã‚’æ¡ç”¨
        const cols = line.split(',');
        if (cols.length >= 2) return cols[1].replace(/^"|"$/g, '').trim();
        return null;
    }).filter(t => t);
}

// æç”»å‡¦ç†
function render() {
    const container = document.getElementById('previewArea');
    container.innerHTML = "";
    
    const startPos = parseInt(document.getElementById('startPos').value);
    const itemsPerPage = rows * cols; // 72
    const totalItems = startPos + csvData.length;
    const pageCount = Math.ceil(totalItems / itemsPerPage) || 1;
    
    let dataIndex = 0;

    for (let p = 0; p < pageCount; p++) {
        const sheet = document.createElement('div');
        sheet.className = 'sheet';
        
        const grid = document.createElement('div');
        grid.className = 'grid-container';
        
        for (let i = 0; i < itemsPerPage; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            
            if (i >= startPos && dataIndex < csvData.length) {
                const text = csvData[dataIndex];
                
                const textDiv = document.createElement('div');
                textDiv.className = 'text-container';
                
                // 2ã¤ã®spanã‚’ä½œã‚‹ï¼ˆå·¦å³å¯¾ç§°ï¼‰
                // contenteditable="true" ã‚’ã¤ã‘ã¦ç·¨é›†å¯èƒ½ã«
                const span1 = document.createElement('span');
                span1.className = 'label-text';
                span1.textContent = text;
                span1.contentEditable = true; 
                
                const span2 = document.createElement('span');
                span2.className = 'label-text';
                span2.textContent = text;
                span2.contentEditable = true;
                
                // é•·ä½“å‡¦ç†ï¼ˆç°¡æ˜“ï¼‰
                if (text.length > 5) {
                    const size = (10 * 5 / text.length) + "pt";
                    span1.style.fontSize = size;
                    span2.style.fontSize = size;
                }

                textDiv.appendChild(span1);
                textDiv.appendChild(span2);
                cell.appendChild(textDiv);
                
                dataIndex++;
            }
            grid.appendChild(cell);
        }
        
        sheet.appendChild(grid);
        container.appendChild(sheet);
    }
}
</script>
</body>
</html>
