<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ©ãƒ™ãƒ«ä½œæˆ (Pythonç§»æ¤ç‰ˆ)</title>
<style>
    /* --- Pythonã‚³ãƒ¼ãƒ‰ã‹ã‚‰é€†ç®—ã—ãŸå®šæ•° --- */
    :root {
        --cell-w: 31.5mm; /* perrow */
        --cell-h: 24.8mm; /* percol */
        --mirror-dist: 6.1mm; /* mirroring_distance */
        /* ä»¥ä¸‹ã¯Pythonåº§æ¨™(ä¸­å¿ƒç‚¹)ã‹ã‚‰CSSãƒœãƒƒã‚¯ã‚¹ä½ç½®ã¸ã®å¤‰æ› */
        /* firstcenter_x(275.6) + half_w(15.75) = 291.35mm (å³ç«¯) */
        /* firstcenter_y(195.4) + half_h(12.4) = 207.8mm (ä¸Šç«¯) */
        /* A4æ¨ª(297x210)ã«å¯¾ã™ã‚‹ä½™ç™½ */
        --margin-top: 2.2mm;   /* 210 - 207.8 */
        --margin-right: 5.65mm; /* 297 - 291.35 */
    }

    /* --- åŸºæœ¬UI --- */
    body { font-family: sans-serif; background: #525659; margin: 0; padding: 20px; }
    #controls {
        background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3); max-width: 900px; margin: 0 auto 30px;
    }
    h2 { font-size: 1.1rem; margin-top: 0; color: #333; }
    .btn-group { display: flex; gap: 10px; margin-top: 10px; }
    button { padding: 8px 16px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
    .btn-blue { background: #007bff; color: white; }
    .btn-green { background: #28a745; color: white; }
    
    /* --- å°åˆ·è¨­å®š (A4 æ¨ª) --- */
    @page {
        size: A4 landscape; /* æ¨ªå‘ãæŒ‡å®š */
        margin: 0;
    }

    /* --- ã‚·ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
    .sheet {
        /* A4 æ¨ªã‚µã‚¤ã‚º */
        width: 297mm;
        height: 210mm;
        background: white;
        margin: 0 auto;
        position: relative;
        box-shadow: 0 0 15px rgba(0,0,0,0.5);
        page-break-after: always;
        overflow: hidden; /* ã¯ã¿å‡ºã—é˜²æ­¢ */
    }

    /* ã‚°ãƒªãƒƒãƒ‰ã‚³ãƒ³ãƒ†ãƒŠ */
    .grid-container {
        position: absolute;
        top: var(--margin-top);
        right: var(--margin-right);
        
        /* 9åˆ—(rows) x 8æ®µ(cols) â€»Pythonå¤‰æ•°ã®å‘½åæº–æ‹  */
        width: calc(var(--cell-w) * 9);
        height: calc(var(--cell-h) * 8);
        
        display: grid;
        /* Pythonã¯å³ã‹ã‚‰å·¦ã¸åˆ—ãŒé€²ã‚€ -> RTLæ–¹å‘ */
        direction: rtl;
        
        grid-template-columns: repeat(9, var(--cell-w));
        grid-template-rows: repeat(8, var(--cell-h));
        
        /* Pythonã¯ i(rows) ã®ä¸­ã§ j(cols) ã‚’å›ã™ 
           ã¤ã¾ã‚Šã€Œç¸¦(j)ã‚’åŸ‹ã‚ã¦ã‹ã‚‰ã€æ¨ª(i)ã¸ç§»å‹•ã€
           grid-auto-flow: column ã§ç¸¦æ–¹å‘ã«åŸ‹ã¾ã‚‹ */
        grid-auto-flow: column; 
    }

    /* --- ãƒ©ãƒ™ãƒ«1å€‹ã®æ  --- */
    .cell {
        width: var(--cell-w);
        height: var(--cell-h);
        position: relative;
        /* é–‹ç™ºç”¨æ ç·šï¼ˆå°åˆ·æ™‚ã¯æ¶ˆã™ï¼‰ */
        border: 0.1px solid #eee;
        box-sizing: border-box;
    }

    /* --- æ–‡å­—æç”»ã‚¨ãƒªã‚¢ (ãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°) --- */
    .text-pair {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        width: 100%; height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    /* æ–‡å­—å…±é€šè¨­å®š */
    .label-text {
        position: absolute;
        writing-mode: vertical-rl;
        text-orientation: upright;
        font-family: "HeiseiMin-W3", "Hiragino Mincho ProN", serif;
        font-size: 10pt; /* åˆæœŸã‚µã‚¤ã‚º */
        white-space: nowrap;
        line-height: 1;
    }
    
    /* ä¸­å¿ƒã‹ã‚‰å·¦å³ã¸mirror_dist(6.1mm)é›¢ã™ */
    /* Pythonã‚³ãƒ¼ãƒ‰ã® x +/- mirroring_distance ã¯æ¨ªè»¸ */
    .text-left {
        /* ä¸­å¿ƒã‹ã‚‰å·¦ã¸6.1mm */
        margin-right: calc(var(--mirror-dist) * 2); 
    }
    .text-right {
        /* å³å´ */
        /* positionã§åˆ¶å¾¡ã—ãŸã»ã†ãŒç¢ºå®Ÿã‹ã‚‚ã§ã™ãŒã€flex centeré…ç½®ãªã®ã§marginã§é›¢é–“ */
    }

    /* --- å°åˆ·æ™‚åˆ¶å¾¡ --- */
    @media print {
        body { background: white; padding: 0; }
        #controls { display: none; }
        .sheet { margin: 0; box-shadow: none; }
        .cell { border: none; } /* æ ç·šã‚’æ¶ˆã™ */
        
        /* Chromeç­‰ã®å¼·åˆ¶èƒŒæ™¯ç™½å¡—ã‚Šå¯¾ç­– */
        * { -webkit-print-color-adjust: exact; }
    }
</style>
</head>
<body>

<div id="controls">
    <h2>ğŸ“‹ ãƒ©ãƒ™ãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (Pythonäº’æ›ãƒ»A4æ¨ª)</h2>
    <p style="font-size:0.9rem; margin:5px 0;">Pythonã‚³ãƒ¼ãƒ‰ã®åº§æ¨™ç³»ï¼ˆx=275.6mmé–‹å§‹, å³ã‹ã‚‰å·¦, ç¸¦ä¸¦ã³, ãƒ€ãƒ–ãƒ«ãƒ—ãƒªãƒ³ãƒˆï¼‰ã‚’å†ç¾ã—ã¾ã—ãŸã€‚</p>
    
    <div style="margin-bottom: 10px;">
        <label>CSVãƒ•ã‚¡ã‚¤ãƒ«: <input type="file" id="csvFile" accept=".csv" onchange="loadCSV(this)"></label>
        <label style="margin-left:15px;">åˆ—ç•ªå·: <input type="number" id="colIdx" value="2" style="width:40px"></label>
    </div>
    <div style="margin-bottom: 10px;">
        <label>é–‹å§‹ä½ç½®(ç©ºã): <input type="number" id="startPos" value="0" min="0" style="width:50px"></label> 
        <small>(â€»Pythonãƒ­ã‚¸ãƒƒã‚¯é †ï¼šå³ä¸Šã®åˆ—ã‹ã‚‰ä¸‹ã¸ã€ãã—ã¦å·¦ã¸)</small>
    </div>
    
    <div class="btn-group">
        <button class="btn-blue" onclick="render()">å†æç”»</button>
        <button class="btn-green" onclick="window.print()">å°åˆ·ã™ã‚‹</button>
    </div>
</div>

<div id="printArea"></div>

<script>
let csvData = [];

// åˆæœŸã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
const sampleData = `ID,ç§‘ç›®å
1,ç¾é‡‘
2,å½“åº§é é‡‘
3,æ™®é€šé é‡‘
4,å—å–æ‰‹å½¢
5,å£²æ›é‡‘
6,æ£šå¸è³‡ç”£
7,å‰æ‰•è²»ç”¨
8,å»ºç‰©
9,æ§‹ç¯‰ç‰©
10,æ©Ÿæ¢°è£…ç½®
11,æ¸›ä¾¡å„Ÿå´ç´¯è¨ˆé¡`;

window.onload = function() {
    csvData = parseCSV(sampleData);
    render();
};

function loadCSV(input) {
    if (!input.files[0]) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        csvData = parseCSV(e.target.result);
        render();
    };
    reader.readAsText(input.files[0]); // ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–(UTF-8æ¨å¥¨)
}

function parseCSV(text) {
    return text.split(/\r\n|\n/).map(line => {
        return line.split(',').map(c => c.replace(/^"|"$/g, '').trim());
    });
}

function render() {
    const container = document.getElementById('printArea');
    container.innerHTML = "";
    
    const colIdx = parseInt(document.getElementById('colIdx').value) - 1;
    const startPos = parseInt(document.getElementById('startPos').value);
    
    // ãƒ‡ãƒ¼ã‚¿æŠ½å‡º
    const titles = csvData.map(row => row[colIdx]).filter(t => t);
    
    // ãƒšãƒ¼ã‚¸è¨­å®š
    const rows = 9; // Pythonã‚³ãƒ¼ãƒ‰ã® rows (å®Ÿã¯åˆ—æ•° Xè»¸æ–¹å‘)
    const cols = 8; // Pythonã‚³ãƒ¼ãƒ‰ã® cols (å®Ÿã¯æ®µæ•° Yè»¸æ–¹å‘)
    const itemsPerPage = rows * cols; // 72
    
    const totalItems = startPos + titles.length;
    const pageCount = Math.ceil(totalItems / itemsPerPage) || 1;
    
    let dataIndex = 0;

    for (let p = 0; p < pageCount; p++) {
        const sheet = document.createElement('div');
        sheet.className = 'sheet';
        
        const grid = document.createElement('div');
        grid.className = 'grid-container';
        
        // ã‚°ãƒªãƒƒãƒ‰ç”Ÿæˆ (72ãƒã‚¹)
        for (let i = 0; i < itemsPerPage; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            
            // ãƒ‡ãƒ¼ã‚¿åŸ‹ã‚è¾¼ã¿åˆ¤å®š
            if (i >= startPos && dataIndex < titles.length) {
                const text = titles[dataIndex];
                
                // ãƒ†ã‚­ã‚¹ãƒˆãƒšã‚¢ä½œæˆ (ãƒ€ãƒ–ãƒ«ãƒ—ãƒªãƒ³ãƒˆç”¨)
                const pairDiv = document.createElement('div');
                pairDiv.className = 'text-pair';
                
                // å·¦å´ãƒ†ã‚­ã‚¹ãƒˆ (Mirror Left)
                const spanL = document.createElement('span');
                spanL.className = 'label-text text-left';
                spanL.textContent = text;
                
                // å³å´ãƒ†ã‚­ã‚¹ãƒˆ (Mirror Right)
                const spanR = document.createElement('span');
                spanR.className = 'label-text text-right';
                spanR.textContent = text;

                // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºè‡ªå‹•èª¿æ•´ (Pythonã‚³ãƒ¼ãƒ‰ã®å†ç¾)
                // maxlinelen > 5 ã®ã¨ãã‚µã‚¤ã‚ºèª¿æ•´ãƒ­ã‚¸ãƒƒã‚¯ã«è¿‘ã„ã‚‚ã®
                // 3.3mm * 5 / len â‰’ 9.3pt * 5 / len
                if (text.length > 5) {
                    const newSize = (9.5 * 5 / text.length) + "pt";
                    spanL.style.fontSize = newSize;
                    spanR.style.fontSize = newSize;
                }
                
                pairDiv.appendChild(spanL);
                pairDiv.appendChild(spanR);
                cell.appendChild(pairDiv);
                
                dataIndex++;
            }
            
            grid.appendChild(cell);
        }
        
        sheet.appendChild(grid);
        container.appendChild(sheet);
    }
}
</script>

</body>
</html>
